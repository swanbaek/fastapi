{% extends 'base.html' %}

{% block title %}ê²Œì‹œê¸€ ëª©ë¡{% endblock %}

{% block content %}
<div class="container post-list">
    <h1 style="text-align: center;margin-bottom:1.7rem">ğŸ“ Posts</h1>
    <div class="post-header" style="display:flex; justify-content:flex-end; align-items:center;gap:8px; margin-bottom:18px;">       
        <a href="/posts/list" class="btn btn-danger btn-wide">ê¸€ëª©ë¡</a>
        <!-- <a href="/posts/new" class="btn btn-primary btn-wide" id="writeBtn" style="display:none;">ê¸€ì“°ê¸°</a> -->
         <span id="writeBtnArea"></span>
        
    </div>
    <table class="post-table">
        <thead>
            <tr>
                <th>ë²ˆí˜¸</th>
                <th>ì œëª©</th>
                <th>ì‘ì„±ì</th>
                <th>ì‘ì„±ì¼</th>
                <th>ì¡°íšŒìˆ˜</th>
            </tr>
        </thead>
        <tbody>
            {% for post in posts %}
            <tr class="post-row" onclick="location.href='/posts/{{ post.id }}'">
                <td>{{ post.id }}</td>
                <td class="post-title">
                    <span class="post-title-text">
                        {% if post.file_url and post.file_url.startswith('/static/uploads/') and ('.' in post.file_url) %}
                            <span title="ì²¨ë¶€íŒŒì¼ ìˆìŒ" style="vertical-align:middle; margin-left:6px; font-size:18px;">ğŸ“</span>
                        {% else %}
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% endif %}
                        {{ post.title }}
                    </span>
                </td>
                <td>{{ post.author.name if post.author else 'ì•Œ ìˆ˜ ì—†ìŒ' }}</td>
                <td>{{ post.created_at.strftime('%y-%m-%d') if post.created_at else '' }}</td>
                <td>{{ post.hit_count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="pagination">
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ í•„ìš”ì‹œ -->
    </div>
</div>
{% endblock %}

{% block script %}
<script src="/static/common.js"></script>
<script>
// ë¡œê·¸ì¸ ìƒíƒœë©´ ê¸€ì“°ê¸° ë²„íŠ¼ ë³´ì´ê¸°
document.addEventListener('DOMContentLoaded', function() {
    const accessToken = localStorage.getItem('accessToken');
    if (accessToken) {
        const payload = parseJwt(accessToken);  // base.htmlì— parseJwt ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        if (payload) {
            document.getElementById('writeBtnArea').innerHTML = 
                '<a href="/posts/new" class="btn btn-primary btn-wide">ê¸€ì“°ê¸°</a>';
        }
    }
});
</script>
{% endblock %}
