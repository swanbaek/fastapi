{% extends 'base.html' %}

{% block title %}회원목록{% endblock %}

{% block content %}
    <div class="container">
        <h2>회원목록</h2>
        <table id="usersTable" class="users-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>이름</th>
                    <th>이메일</th>
                    <th>가입일</th>
                </tr>
            </thead>
            <tbody>
                <!-- 회원 데이터가 JS로 채워집니다 -->
            </tbody>
        </table>
    </div>
{% endblock %}

{% block script %}
<script src="/static/common.js"></script>
    <script>
    async function fetchUsers() {
        const res = await apiFetch('/api/users');
        const tbody = document.querySelector('#usersTable tbody');
        tbody.innerHTML = '';
        if (res.ok) {
            const users = await res.json();
            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.created_at ? user.created_at.replace('T',' ').slice(0,19) : ''}</td>
                `;
                tbody.appendChild(tr);
            });
        } else {
            let msg = '회원목록을 볼 권한이 없습니다.';
            if (res.status === 401) msg = '로그인 후 이용 가능합니다.';
            if (res.status === 403) msg = '관리자만 볼 수 있습니다.';
            try {
                if (res.headers.get('content-type')?.includes('application/json')) {
                    const err = await res.json();
                    msg = err.detail || msg;
                }
            } catch (e) {}
            tbody.innerHTML = `<tr><td colspan="4" style="color:red;text-align:center;">${msg}</td></tr>`;
        }
    }
    fetchUsers();
    </script>
{% endblock %}
